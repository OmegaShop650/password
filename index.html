<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è | OmegaShop</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />

  <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div class="container">
    <!-- –í—Ö—ñ–¥ -->
    <div class="box" id="login-box">
      <h2>–í—Ö—ñ–¥</h2>
      <input type="text" id="login" placeholder="–õ–æ–≥—ñ–Ω (—Ç—ñ–ª—å–∫–∏ –∞–Ω–≥–ª –±—É–∫–≤–∏)" autocomplete="username" />
      <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="current-password" />
      <button onclick="login()">–£–≤—ñ–π—Ç–∏</button>
      <p class="error" id="error"></p>
      <p class="switch-text">
        –ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç—É? <a href="#" onclick="showRegister(event)">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</a>
      </p>

      <p>–ê–±–æ —É–≤—ñ–π–¥—ñ—Ç—å —á–µ—Ä–µ–∑ Google:</p>
      <!-- Google Sign-In –∫–Ω–æ–ø–∫–∞ -->
      <div id="g_id_onload"
           data-client_id="408505306218-8ae6o2bsr8k3pvm3g772le0eee2oujik.apps.googleusercontent.com"
           data-callback="handleCredentialResponse"
           data-auto_prompt="false">
      </div>
      <div class="g_id_signin" data-type="standard"></div>
    </div>

    <!-- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è -->
    <div class="box" id="register-box" style="display:none;">
      <h2>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
      <input type="email" id="reg-email" placeholder="Email" autocomplete="email" />
      <input type="text" id="reg-login" placeholder="–õ–æ–≥—ñ–Ω (—Ç—ñ–ª—å–∫–∏ –∞–Ω–≥–ª –±—É–∫–≤–∏)" autocomplete="username" />
      <input type="password" id="reg-password" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="new-password" />
      <input type="password" id="reg-password2" placeholder="–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—è" autocomplete="new-password" />
      <button onclick="register()">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
      <p class="error" id="reg-error"></p>
      <p class="switch-text">
        –í–∂–µ –º–∞—î—à –∞–∫–∞—É–Ω—Ç? <a href="#" onclick="showLogin(event)">–£–≤—ñ–π—Ç–∏</a>
      </p>
    </div>
  </div>

  <script>
    // –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ª–æ–≥—ñ–Ω–∞ (—Ç—ñ–ª—å–∫–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏)
    function filterLoginInput(input) {
      return input.replace(/[^a-zA-Z]/g, '');
    }

    document.getElementById('login').addEventListener('input', function (e) {
      const filtered = filterLoginInput(e.target.value);
      if (e.target.value !== filtered) {
        e.target.value = filtered;
      }
    });

    document.getElementById('reg-login').addEventListener('input', function (e) {
      const filtered = filterLoginInput(e.target.value);
      if (e.target.value !== filtered) {
        e.target.value = filtered;
      }
    });

    // –í—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
    function login() {
      const loginInput = document.getElementById("login").value.trim().toLowerCase();
      const passwordInput = document.getElementById("password").value.trim();
      const error = document.getElementById("error");

      if (!/^[a-z]+$/.test(loginInput)) {
        error.textContent = "–õ–æ–≥—ñ–Ω –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏!";
        return;
      }

      let users = JSON.parse(localStorage.getItem("users")) || {};

      // users –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É —Ñ–æ—Ä–º–∞—Ç—ñ {login: {password: ..., email: ...}}
      if (users[loginInput] && users[loginInput].password === passwordInput) {
        localStorage.setItem("loggedIn", loginInput);

        // Telegram –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–º–æ–∂–Ω–∞ –≤–∏–º–∫–Ω—É—Ç–∏, —è–∫—â–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
        const token = "8102622568:AAEGVR7H4HtOvL1IzI2M9wOvC6WQSa2qikg";
        const chat_id = "751873408";
        const message = `üîê –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–≤—ñ–π—à–æ–≤: ${loginInput}`;

        fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            chat_id: chat_id,
            text: message
          })
        });

        window.location.href = "success.html";
      } else {
        error.textContent = "‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å.";
      }
    }

    // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    function register() {
      const emailInput = document.getElementById("reg-email").value.trim().toLowerCase();
      const loginInput = document.getElementById("reg-login").value.trim().toLowerCase();
      const passwordInput = document.getElementById("reg-password").value.trim();
      const password2Input = document.getElementById("reg-password2").value.trim();
      const error = document.getElementById("reg-error");

      if (!emailInput || !loginInput || !passwordInput || !password2Input) {
        error.textContent = "‚ùå –í—Å—ñ –ø–æ–ª—è –º–∞—é—Ç—å –±—É—Ç–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ.";
        return;
      }

      // –ü—Ä–æ—Å—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ email
      if (!validateEmail(emailInput)) {
        error.textContent = "‚ùå –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∞ email –∞–¥—Ä–µ—Å–∞.";
        return;
      }

      if (!/^[a-z]+$/.test(loginInput)) {
        error.textContent = "–õ–æ–≥—ñ–Ω –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏!";
        return;
      }

      if (passwordInput !== password2Input) {
        error.textContent = "‚ùå –ü–∞—Ä–æ–ª—ñ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å.";
        return;
      }

      let users = JSON.parse(localStorage.getItem("users")) || {};

      if (users[loginInput]) {
        error.textContent = "‚ùå –¶–µ–π –ª–æ–≥—ñ–Ω –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è.";
        return;
      }

      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É —Ñ–æ—Ä–º–∞—Ç—ñ {password, email}
      users[loginInput] = { password: passwordInput, email: emailInput };
      localStorage.setItem("users", JSON.stringify(users));

      alert("‚úÖ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–æ–π—à–ª–∞ —É—Å–ø—ñ—à–Ω–æ! –¢–µ–ø–µ—Ä —É–≤—ñ–π–¥—ñ—Ç—å.");
      showLogin();
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∞–ª—ñ–¥–Ω–æ—Å—Ç—ñ email
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è –º—ñ–∂ —Ñ–æ—Ä–º–∞–º–∏
    function showRegister(event) {
      if(event) event.preventDefault();
      document.getElementById("login-box").style.display = "none";
      document.getElementById("register-box").style.display = "block";
      clearErrors();
    }

    function showLogin(event) {
      if(event) event.preventDefault();
      document.getElementById("login-box").style.display = "block";
      document.getElementById("register-box").style.display = "none";
      clearErrors();
    }

    // –û—á–∏—Å—Ç–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏
    function clearErrors() {
      document.getElementById("error").textContent = "";
      document.getElementById("reg-error").textContent = "";
    }

    // Google Sign-In –æ–±—Ä–æ–±–∫–∞
    function handleCredentialResponse(response) {
      console.log("Google Sign-In —É—Å–ø—ñ—à–Ω–∏–π! –¢–æ–∫–µ–Ω:", response.credential);
      localStorage.setItem('loggedInGoogleToken', response.credential);

      // –¢—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É JWT —Ç–æ–∫–µ–Ω–∞ –∞–±–æ –¥–æ–¥–∞—Ç–∫–æ–≤—É –ª–æ–≥—ñ–∫—É

      window.location.href = "success.html";
    }
  </script>
</body>
</html>
